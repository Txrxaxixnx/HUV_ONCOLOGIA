# Analisis: `ui.py`

## Rol
- Interfaz de usuario (Tkinter). Orquesta el flujo del procesamiento, la seleccion de archivos, el seguimiento en tiempo real y la generacion del Excel final.

## Componentes principales
- Clase `HUVOCRSystem(root)`:
  - Estado: `self.files` (lista de PDFs), `self.output_dir` (carpeta de salida).
  - Parametros UI leidos de `config.ini` (seccion `INTERFACE` y `OUTPUT`).
  - Widgets: botones de agregar archivos/carpeta, limpiar, seleccionar salida; listbox; barra de progreso; log.

## Flujo de uso
1) Usuario agrega archivos o carpeta (se filtran `.pdf`).
2) Selecciona carpeta de salida.
3) Clic en "PROCESAR INFORMES".
4) Hilo en background ejecuta `_process_files()` para no bloquear la UI.

## `_process_files()`
- Recorre `self.files` y por cada PDF:
  - Llama a `ocr_processing.pdf_to_text_enhanced(path)`.
  - Guarda texto crudo para depuración en la carpeta de salida (archivo `DEBUG_OCR_OUTPUT_<pdf>.txt`).
  - Determina el tipo con `data_extraction.detect_report_type(text)` y mapea las filas vía `data_extraction.process_text_to_excel_rows(text, filename)`.
    - Si `[PROCESSORS].ENABLE_PROCESSORS=true`, se enruta a procesadores especializados (IHQ, Biopsia, Revisión) cuando corresponda.
    - Si no, se usa la ruta base (`extract_huv_data` + `map_to_excel_format`) de forma transparente.
  - Actualiza barra de progreso y logs.
- Al finalizar:
  - Crea `DataFrame` con `pandas` y exporta a Excel (`openpyxl`).
  - Aplica formato a encabezados (fuente/align/fill) y ajuste de ancho de columnas.
  - Muestra dialogo de exito/fallo con resumen.

## Errores/eventos que maneja
- Validaciones: sin archivos, sin carpeta salida -> `messagebox.showwarning`.
- Excepciones por archivo -> se registran y contabilizan, no detienen el lote.
- Registra conteos: procesados, con error, total de filas.

## Conexiones
- Importa `pdf_to_text_enhanced` de `ocr_processing.py`.
- Importa `extract_huv_data` y `map_to_excel_format` de `data_extraction.py`.
- Usa `openpyxl` para formateo post-exportacion.

## Mejores practicas y mejoras
- Codificacion: unificar UTF-8 para evitar caracteres extranos en la UI/logs.
- Accesibilidad: atajos de teclado para acciones comunes.
- Control de cancelacion: permitir cancelar procesamiento en curso.
- Robustez: envolver `pandas.to_excel` en manejo de archivos bloqueados (p.ej., si esta abierto en Excel).
